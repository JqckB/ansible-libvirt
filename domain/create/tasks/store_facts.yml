---
- name: create facts folder
  file:
    path: "{{ ansible_facts_path }}"
    state: directory
    recurse: yes

- name: store fact ssh_port
  ini_file:
    dest: "{{ ansible_facts_path }}/libvirt.fact"
    section: "facts"
    option: "ssh_port"
    value: "{{ libvirt_result_ssh_port }}"
  when: libvirt_result_ssh_port_generated | bool

- name: store_facts | store
  template:
    dest: "{{ ansible_facts_path }}/libvirt_domains.fact"
    src: libvirt_domains.j2

- name: re-read facts
  setup:
    filter: ansible_local
